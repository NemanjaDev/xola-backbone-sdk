!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("underscore"),require("backbone")):"function"==typeof define&&define.amd?define(["underscore","backbone"],t):"object"==typeof exports?exports.XolaBackboneSDK=t(require("underscore"),require("backbone")):e.XolaBackboneSDK=t(e._,e.Backbone)}(this,function(e,t){return function(e){function t(o){if(i[o])return i[o].exports;var n=i[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var i={};return t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,o){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=22)}([function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.BaseModel=void 0;var n=i(2),r=o(n),l=i(3),a=o(l);t.BaseModel=a.default.Model.extend({parent:null,parentUrlRoot:null,filters:null,initialize:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r.default.defaults(t,{parent:null}),this.parent=t.parent,this.filters={}},url:function(e){var t,i=this.parent?this.parent.url(this.parentUrlRoot):"";if(e)if(this.isNew())t=e;else{var o=this.get(this.idAttribute);t=e.replace(/[^\/]$/,"$&/")+encodeURIComponent(o)}else t=a.default.Model.prototype.url.apply(this);return i+t},fetch:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r.default.defaults(e,{data:{}}),r.default.extend(e.data,this.filters),a.default.Model.prototype.fetch.apply(this,[e])},parse:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e?(r.default.each(e,function(o,n){var r=o;t.constructor.PARSERS&&t.constructor.PARSERS[n]&&(r=t.constructor.PARSERS[n](o,i,t),r instanceof a.default.Model&&t.has(n)&&t.get(n).id==r.id&&(t.get(n).set(r.attributes),r=t.get(n)),r instanceof a.default.Collection&&t.has(n)&&(t.get(n).set(r.models),r=t.get(n))),e[n]=r}),e):e}})},function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.BaseCollection=void 0;var n=i(2),r=o(n),l=i(3),a=o(l),s=i(0);t.BaseCollection=a.default.Collection.extend({model:s.BaseModel,parent:null,filters:null,initialize:function(){var e=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});r.default.defaults(e,{parent:null}),this.parent=e.parent,this.filters={}},url:function(){return(this.parent?this.parent.url():"")+this.model.prototype.urlRoot},parse:function(e){return e.hasOwnProperty("paging")&&e.hasOwnProperty("data")?e.data:e},get:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=a.default.Collection.prototype.get.apply(this,[e]);if(!i&&t){var o={};o[this.model.prototype.idAttribute]=e,i=new this.model(o),this.add(i)}return i},fetch:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r.default.defaults(e,{data:{}}),r.default.extend(e.data,this.filters),a.default.Collection.prototype.fetch.apply(this,[e])}},{buildModelPropertyComparator:function(e){return function(t){return t.get(e)}}})},function(t,i){t.exports=e},function(e,i){e.exports=t},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExperienceCollection=void 0;var o=i(1),n=i(21),r=i(10);t.ExperienceCollection=o.BaseCollection.extend({model:r.Experience,initialize:function(){var e=this;o.BaseCollection.prototype.initialize.apply(this,arguments),this.availability=new n.AvailabilityCollection(null,{experiences:this}),this.listenTo(this,"update",function(){e.availability.filters.experience=e.pluck("id").join(",")})},getAvailability:function(){return this.availability}},{POOL_ID:"Experiences"})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParseHelper=void 0;var o=i(0),n=i(1),r=i(6);t.ParseHelper={Date:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return new Date(e)}),Locale:function(e){return e.replace("_","-")},Model:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.prototype instanceof n.BaseCollection?function(t,i){var o=e.prototype.model.prototype.idAttribute,n=r.CollectionPool.getCollection(e).get(t[o],!0);return n.set(n.parse(t,i),i),n}:e.prototype instanceof o.BaseModel?function(i,o){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return t&&n&&(i.parent=n),new e(i,{parse:!0})}:void 0},Collection:function(e){return function(t,i){return new e(t,i)}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={};t.CollectionPool={getCollection:function(e){if(!e.hasOwnProperty("POOL_ID"))throw new Error(e+" is not a valid Collection");return o.hasOwnProperty(e.POOL_ID)||(o[e.POOL_ID]=new e),o[e.POOL_ID]}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DemographicCollection=void 0;var o=i(1),n=i(8);t.DemographicCollection=o.BaseCollection.extend({model:n.Demographic},{POOL_ID:"Demographics"})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Demographic=void 0;var o=i(0);t.Demographic=o.BaseModel.extend({urlRoot:"/demographics",getLabel:function(){return this.get("label")}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Event=void 0;var o=i(0),n=i(5),r=i(4);t.Event=o.BaseModel.extend({urlRoot:"/events"},{PARSERS:{start_date:n.ParseHelper.Date,experience:n.ParseHelper.Model(r.ExperienceCollection)}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Experience=void 0;var o=i(3),n=(function(e){e&&e.__esModule}(o),i(0)),r=i(14),l=i(7),a=i(5);t.Experience=n.BaseModel.extend({urlRoot:"/experiences",initialize:function(){n.BaseModel.prototype.initialize.apply(this,arguments),this.availability=new r.Availability(null,{parent:this})},getAvailability:function(){return this.availability},getDemographics:function(){return this.get("demographics")}},{PARSERS:{demographics:a.ParseHelper.Collection(l.DemographicCollection)}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Order=void 0;var o=i(0);t.Order=o.BaseModel.extend({urlRoot:"/orders",calculateAmount:function(){var e=0,t=0,i=this.get("experience").get("price");this.get("experience").get("currency");this.get("demographics").each(function(o){var n=o.get("quantity"),r=o.calculatePrice(i),l=r*n;e+=n,t+=l}),this.set("quantity",e),this.set("amount",t)},checkIn:function(e){var t=new o.BaseModel({updates:{guestStatus:"arrived"}},{parent:this});t.urlRoot="/modify",t.save(null,e)},toJSON:function(){var e=o.BaseModel.prototype.toJSON.apply(this,arguments);return e.demographics=this.get("demographics").toJSON(),e.seller={id:this.get("seller").id},e.experience={id:this.get("experience").id},e.payment=this.get("payment").toJSON(),e}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OrderDemographic=void 0;var o=i(0);t.OrderDemographic=o.BaseModel.extend({urlRoot:null,initialize:function(e){o.BaseModel.prototype.initialize.apply(this,arguments),this.set({id:e.demographic.id,label:e.demographic.getLabel()})},getQuantity:function(){return this.get("quantity")},setQuantity:function(e){return this.set("quantity",e)},calculatePrice:function(e){var t=this.get("demographic");if(!t.has("discount"))return e;switch(t.get("discount").amountType){case"absolute":return e-t.get("discount").amount;default:return e}}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.User=void 0;var o=i(2),n=function(e){return e&&e.__esModule?e:{default:e}}(o),r=i(0),l=i(5),a=i(23),s={ROLE_SELLER:"ROLE_SELLER",ROLE_SUPER_ADMIN:"ROLE_SUPER_ADMIN",ROLE_ADMIN:"ROLE_ADMIN",ROLE_RESERVATION:"ROLE_RESERVATION",ROLE_RESERVATION_LITE:"ROLE_RESERVATION_LITE",ROLE_GUIDE_MANAGER:"ROLE_GUIDE_MANAGER"};t.User=r.BaseModel.extend({urlRoot:"/users",hasRole:function(e){return n.default.contains(this.get("roles"),e)},isSeller:function(){return this.hasRole(s.ROLE_SELLER)},isAdmin:function(){return this.hasRole(s.ROLE_ADMIN)||this.hasRole(s.ROLE_SUPER_ADMIN)},isReservationist:function(){return this.hasRole(s.ROLE_RESERVATION)||this.hasRole(s.ROLE_RESERVATION_LITE)},isGuideManager:function(){return this.hasRole(s.ROLE_GUIDE_MANAGER)}},n.default.extend({PARSERS:{locale:l.ParseHelper.Locale,meta:l.ParseHelper.Model(a.Meta)}},s))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Availability=void 0;var o=i(0);t.Availability=o.BaseModel.extend({urlRoot:"/availability",initialize:function(){o.BaseModel.prototype.initialize.apply(this,arguments)},parse:function(e,t){return t.parent=e._experience,delete e._experience,o.BaseModel.prototype.parse.call(this,e,t)},getSlotsByDate:function(e){return this.get(e)},getSlotsByDateTime:function(e,t){return this.getSlotsByDate(e)[t]}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventCollection=void 0;var o=i(1),n=i(9);t.EventCollection=o.BaseCollection.extend({model:n.Event},{POOL_ID:"Events"})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OrderDemographicCollection=void 0;var o=i(1),n=i(12);t.OrderDemographicCollection=o.BaseCollection.extend({model:n.OrderDemographic},{POOL_ID:"OrderDemographics"})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OrderCollection=void 0;var o=i(1),n=i(11);t.OrderCollection=o.BaseCollection.extend({model:n.Order},{POOL_ID:"Orders"})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserCollection=void 0;var o=i(1),n=i(13);t.UserCollection=o.BaseCollection.extend({model:n.User},{POOL_ID:"Users"})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Payment=void 0;var o=i(2),n=function(e){return e&&e.__esModule?e:{default:e}}(o),r=i(0),l={METHOD_CREDIT_CARD:"cc"};t.Payment=r.BaseModel.extend({toJSON:function(){var e=r.BaseModel.prototype.toJSON.apply(this,arguments);switch(this.get("method")){case l.METHOD_CREDIT_CARD:e.card=this.get("card").toJSON()}return e}},n.default.extend({PARSERS:{}},l))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Seller=void 0;var o=i(0),n=i(4);t.Seller=o.BaseModel.extend({urlRoot:"/sellers",initialize:function(){this.experiences=new n.ExperienceCollection,this.experiences.filters.seller=this.id},getExperiences:function(){return this.experiences}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AvailabilityCollection=void 0;var o=i(2),n=function(e){return e&&e.__esModule?e:{default:e}}(o),r=i(1),l=i(14);t.AvailabilityCollection=r.BaseCollection.extend({model:l.Availability,initialize:function(e,t){var i=this;r.BaseCollection.prototype.initialize.apply(this,arguments),this.experiences=t.experiences,this.listenTo(this,"update",function(){i.each(function(e){e.parent.getAvailability().set(e.attributes)})})},parse:function(e){var t=this,i=[];return n.default.each(e,function(e,o,n){e._experience=t.experiences.get(o),i.push(e)}),i}})},function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}var n,r=i(2),l=o(r),a=i(3),s=o(a),u=i(0),c=i(1),d=i(8),p=i(10),f=i(9),h=i(11),v=i(12),g=i(19),_=i(20),O=i(13),y=i(7),E=i(4),R=i(15),x=i(17),M=i(16),P=i(18),m=i(6),b=null,C={BaseModel:u.BaseModel,BaseCollection:c.BaseCollection,Model:{Demographic:d.Demographic,Experience:p.Experience,Event:f.Event,Order:h.Order,OrderDemographic:v.OrderDemographic,Payment:g.Payment,Seller:_.Seller,User:O.User},Collection:{Demographics:y.DemographicCollection,Experiences:E.ExperienceCollection,Events:R.EventCollection,Orders:x.OrderCollection,OrderDemographics:M.OrderDemographicCollection,Users:P.UserCollection},CollectionPool:m.CollectionPool,setBaseUrl:function(e){s.default.$.ajaxSetup({beforeSend:function(t,i){i.url=e+i.url,i.crossDomain=!0}})},setApiKey:function(e){var t=s.default.$.ajaxSetup().headers||{};e?t["X-API-KEY"]=e:delete t["X-API-KEY"],s.default.$.ajaxSetup(s.default.$.ajaxSettings,{headers:t})},setApiVersion:function(e){var t=s.default.$.ajaxSetup().headers||{};e?t["X-API-VERSION"]=e:delete t["X-API-VERSION"],s.default.$.ajaxSetup(s.default.$.ajaxSettings,{headers:t})},login:function(e,t){var i=this,o=s.default.$.ajaxSetup().headers||{};o.Authorization="Basic "+btoa(e+":"+t),delete o["X-API-KEY"],s.default.$.ajaxSetup(s.default.$.ajaxSettings,{headers:o});var n=m.CollectionPool.getCollection(P.UserCollection).get("me",!0);n.fetch({success:function(e){n=e,i.setApiKey(e.get("apiKey")),i.trigger("user.login",e)}})},logout:function(){this.setApiKey(),b=null,this.trigger("user.logout")}};n||(l.default.extend(C,s.default.Events),C.setBaseUrl("http://xola.local/api"),C.setApiVersion("2017-09-13"),n=!0),e.exports=C},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Meta=void 0;var o=i(0);t.Meta=o.BaseModel.extend({urlRoot:"/meta"})}])});