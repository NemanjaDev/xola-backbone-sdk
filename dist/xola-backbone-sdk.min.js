!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("underscore"),require("backbone")):"function"==typeof define&&define.amd?define(["underscore","backbone"],t):"object"==typeof exports?exports.XolaBackboneSDK=t(require("underscore"),require("backbone")):e.XolaBackboneSDK=t(e._,e.Backbone)}(this,function(e,t){return function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=15)}([function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.BaseModel=void 0;var o=n(2),r=i(o),l=n(4),a=i(l);t.BaseModel=a.default.Model.extend({parent:null,parentUrlRoot:null,filters:{},initialize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.parent,n=void 0===t?null:t;this.parent=n},url:function(e){var t,n=this.parent?this.parent.url(this.parentUrlRoot):"";if(e)if(this.isNew())t=e;else{var i=this.get(this.idAttribute);t=e.replace(/[^\/]$/,"$&/")+encodeURIComponent(i)}else t=a.default.Model.prototype.url.apply(this);return n+t},fetch:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r.default.defaults(e,{data:{}}),r.default.extend(e.data,this.filters),a.default.Model.prototype.fetch.apply(this,[e])},parse:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e?(r.default.each(e,function(i,o){var r=i;t.constructor.PARSERS&&t.constructor.PARSERS[o]&&(r=t.constructor.PARSERS[o](i,n,t),r instanceof a.default.Model&&t.has(o)&&t.get(o).id==r.id&&(t.get(o).set(r.attributes),r=t.get(o)),r instanceof a.default.Collection&&t.has(o)&&(t.get(o).set(r.models),r=t.get(o))),e[o]=r}),e):e}})},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.BaseCollection=void 0;var o=n(2),r=i(o),l=n(4),a=i(l),u=n(0);t.BaseCollection=a.default.Collection.extend({model:u.BaseModel,filters:null,initialize:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.parent,i=void 0===n?null:n;this.parent=i},url:function(){return(this.parent?this.parent.url():"")+this.model.prototype.urlRoot},parse:function(e){return e.hasOwnProperty("paging")&&e.hasOwnProperty("data")?e.data:e},get:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=a.default.Collection.prototype.get.apply(this,[e]);if(!n&&t){var i={};i[this.model.prototype.idAttribute]=e,n=new this.model(i),this.add(n)}return n},fetch:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r.default.defaults(e,{data:{}}),r.default.extend(e.data,this.filters),a.default.Collection.prototype.fetch.apply(this,[e])}},{buildModelPropertyComparator:function(e){return function(t){return t.get(e)}}})},function(t,n){t.exports=e},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExperienceCollection=void 0;var i=n(1),o=n(14),r=n(7);t.ExperienceCollection=i.BaseCollection.extend({model:r.Experience,initialize:function(){this.availability=new o.AvailabilityCollection(null,{igor:1}),this.listenTo(this,"update",this.updateAvailabilityFilters)},updateAvailabilityFilters:function(){this.availability.filters.experience=this.pluck("id").join(",")}},{POOL_ID:"Experiences"})},function(e,n){e.exports=t},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={};t.CollectionPool={getCollection:function(e){if(!e.hasOwnProperty("POOL_ID"))throw new Error(e+" is not a valid Collection");return i.hasOwnProperty(e.POOL_ID)||(i[e.POOL_ID]=new e),i[e.POOL_ID]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Event=void 0;var i=n(0),o=n(9),r=n(3);t.Event=i.BaseModel.extend({urlRoot:"/events"},{PARSERS:{start_date:o.ParseHelper.Date,experience:o.ParseHelper.Model(r.ExperienceCollection)}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Experience=void 0;var i=n(0),o=n(10);t.Experience=i.BaseModel.extend({urlRoot:"/experiences",initialize:function(){this.availability=new o.Availability({parent:this})},getAvailability:function(){return this.availability}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.User=void 0;var i=n(2),o=function(e){return e&&e.__esModule?e:{default:e}}(i),r=n(0),l=n(9),a=n(16),u={ROLE_SELLER:"ROLE_SELLER",ROLE_SUPER_ADMIN:"ROLE_SUPER_ADMIN",ROLE_ADMIN:"ROLE_ADMIN",ROLE_RESERVATION:"ROLE_RESERVATION",ROLE_RESERVATION_LITE:"ROLE_RESERVATION_LITE",ROLE_GUIDE_MANAGER:"ROLE_GUIDE_MANAGER"};t.User=r.BaseModel.extend({urlRoot:"/users",hasRole:function(e){return o.default.contains(this.get("roles"),e)},isSeller:function(){return this.hasRole(u.ROLE_SELLER)},isAdmin:function(){return this.hasRole(u.ROLE_ADMIN)||this.hasRole(u.ROLE_SUPER_ADMIN)},isReservationist:function(){return this.hasRole(u.ROLE_RESERVATION)||this.hasRole(u.ROLE_RESERVATION_LITE)},isGuideManager:function(){return this.hasRole(u.ROLE_GUIDE_MANAGER)}},o.default.extend({PARSERS:{locale:l.ParseHelper.Locale,meta:l.ParseHelper.Model(a.Meta)}},u))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParseHelper=void 0;var i=n(0),o=n(1),r=n(5);t.ParseHelper={Date:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return new Date(e)}),Locale:function(e){return e.replace("_","-")},Model:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.prototype instanceof o.BaseCollection?function(t,n){var i=e.prototype.model.prototype.idAttribute,o=r.CollectionPool.getCollection(e).get(t[i],!0);return o.set(o.parse(t,n),n),o}:e.prototype instanceof i.BaseModel?function(n,i){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return t&&o&&(n.parent=o),new e(n,{parse:!0})}:void 0},Collection:function(e){return function(t,n){return new e(n)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Availability=void 0;var i=n(0);t.Availability=i.BaseModel.extend({urlRoot:"/availability",initialize:function(e){console.log("Availability",arguments)}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventCollection=void 0;var i=n(1),o=n(6);t.EventCollection=i.BaseCollection.extend({model:o.Event},{POOL_ID:"Events"})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserCollection=void 0;var i=n(1),o=n(8);t.UserCollection=i.BaseCollection.extend({model:o.User},{POOL_ID:"Users"})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Seller=void 0;var i=n(0),o=n(3);t.Seller=i.BaseModel.extend({urlRoot:"/sellers",initialize:function(){this.experiences=new o.ExperienceCollection,this.experiences.filters.seller=this.id},getExperiences:function(){return this.experiences}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AvailabilityCollection=void 0;var i=n(1),o=n(10);t.AvailabilityCollection=i.BaseCollection.extend({model:o.Availability,initialize:function(e,t){console.log("AvailabilityCollection",t)},parse:function(e){var t=[];return _.each(e,function(e,n,i){e.id=n,t.push(e)}),t}},{POOL_ID:"Availabilities"})},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var o,r=n(2),l=i(r),a=n(4),u=i(a),s=n(0),c=n(1),d=n(7),f=n(6),p=n(13),v=n(8),h=n(3),E=n(11),_=n(12),R=n(5),O=null,y={BaseModel:s.BaseModel,BaseCollection:c.BaseCollection,Model:{Experience:d.Experience,Event:f.Event,Seller:p.Seller,User:v.User},Collection:{Experiences:h.ExperienceCollection,Events:E.EventCollection,Users:_.UserCollection},CollectionPool:R.CollectionPool,setBaseUrl:function(e){u.default.$.ajaxSetup({beforeSend:function(t,n){n.url=e+n.url,n.crossDomain=!0}})},setApiKey:function(e){var t=u.default.$.ajaxSetup().headers||{};e?t["X-API-KEY"]=e:delete t["X-API-KEY"],u.default.$.ajaxSetup(u.default.$.ajaxSettings,{headers:t})},setApiVersion:function(e){var t=u.default.$.ajaxSetup().headers||{};e?t["X-API-VERSION"]=e:delete t["X-API-VERSION"],u.default.$.ajaxSetup(u.default.$.ajaxSettings,{headers:t})},login:function(e,t){var n=this,i=u.default.$.ajaxSetup().headers||{};i.Authorization="Basic "+btoa(e+":"+t),delete i["X-API-KEY"],u.default.$.ajaxSetup(u.default.$.ajaxSettings,{headers:i});var o=R.CollectionPool.getCollection(_.UserCollection).get("me",!0);o.fetch({success:function(e){o=e,n.setApiKey(e.get("apiKey")),n.trigger("user.login",e)}})},logout:function(){this.setApiKey(),O=null,this.trigger("user.logout")}};o||(l.default.extend(y,u.default.Events),y.setBaseUrl("http://xola.local/api"),y.setApiVersion("2017-09-13"),o=!0),e.exports=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Meta=void 0;var i=n(0);t.Meta=i.BaseModel.extend({urlRoot:"/meta"})}])});