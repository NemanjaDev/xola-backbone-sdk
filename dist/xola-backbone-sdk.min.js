!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("underscore"),require("backbone"),require("jquery")):"function"==typeof define&&define.amd?define(["underscore","backbone","jquery"],t):"object"==typeof exports?exports.XolaBackboneSDK=t(require("underscore"),require("backbone"),require("jquery")):e.XolaBackboneSDK=t(e._,e.Backbone,e.$)}(this,function(e,t,i){return function(e){function t(r){if(i[r])return i[r].exports;var n=i[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var i={};return t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,r){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=28)}([function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.BaseModel=void 0;var n=i(2),o=r(n),l=i(8),s=r(l),a=i(4),u=i(7);t.BaseModel=s.default.Model.extend({parent:null,parentUrlRoot:null,filters:null,initialize:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o.default.defaults(t,{parent:null}),this.parent=t.parent,this.filters={}},url:function(e){var t,i=this.parent?this.parent.url(this.parentUrlRoot):"";if(e)if(this.isNew())t=e;else{var r=this.get(this.idAttribute);t=e.replace(/[^\/]$/,"$&/")+encodeURIComponent(r)}else t=s.default.Model.prototype.url.apply(this);return i+t},sync:function(e,t,i){var r=this,n=i.beforeSend;return i.beforeSend=function(e,t){if(t.url=a.Config.baseUrl+t.url,t.crossDomain=!0,a.Config.apiKey&&e.setRequestHeader("X-API-KEY",a.Config.apiKey),u.Account.currentUser&&u.Account.currentUser.has("apiKey")&&e.setRequestHeader("X-API-KEY",u.Account.currentUser.get("apiKey")),e.setRequestHeader("X-API-VERSION",a.Config.apiVersion),n)return n.call(r,e,t)},s.default.Model.prototype.sync.call(this,e,t,i)},fetch:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o.default.defaults(e,{data:{}}),o.default.extend(e.data,this.filters),s.default.Model.prototype.fetch.apply(this,[e])},parse:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e?(o.default.each(e,function(r,n){var o=r;t.constructor.PARSERS&&t.constructor.PARSERS[n]&&(o=t.constructor.PARSERS[n](r,i,t),o instanceof s.default.Model&&t.has(n)&&t.get(n).id==o.id&&(t.get(n).set(o.attributes),o=t.get(n)),o instanceof s.default.Collection&&t.has(n)&&(t.get(n).set(o.models),o=t.get(n))),e[n]=o}),e):e}})},function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.BaseCollection=void 0;var n=i(2),o=r(n),l=i(8),s=r(l),a=i(0),u=i(4),c=i(7);t.BaseCollection=s.default.Collection.extend({model:a.BaseModel,parent:null,filters:null,paging:{next:null},initialize:function(){var e=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});o.default.defaults(e,{parent:null}),this.parent=e.parent,this.filters={}},url:function(){return(this.parent?this.parent.url():"")+(this.urlRoot?this.urlRoot:this.model.prototype.urlRoot)},parse:function(e){return e.hasOwnProperty("paging")&&e.hasOwnProperty("data")?(this.paging.next=e.paging.next,e.data):e},sync:function(e,t,i){var r=this,n=i.beforeSend;return i.beforeSend=function(e,t){if(t.url=u.Config.baseUrl+t.url,t.crossDomain=!0,u.Config.apiKey&&e.setRequestHeader("X-API-KEY",u.Config.apiKey),c.Account.currentUser&&c.Account.currentUser.has("apiKey")&&e.setRequestHeader("X-API-KEY",c.Account.currentUser.get("apiKey")),e.setRequestHeader("X-API-VERSION",u.Config.apiVersion),n)return n.call(r,e,t)},s.default.Collection.prototype.sync.call(this,e,t,i)},get:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=s.default.Collection.prototype.get.call(this,e);if(!i&&t){var r={};r[this.model.prototype.idAttribute]=e,i=new this.model(r),this.add(i)}return i},fetch:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o.default.defaults(e,{data:{}}),o.default.extend(e.data,this.filters),s.default.Collection.prototype.fetch.apply(this,[e])}},{buildModelPropertyComparator:function(e){return function(t){return t.get(e)}}})},function(t,i){t.exports=e},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParseHelper=void 0;var r=i(0),n=i(1),o=i(9);t.ParseHelper={Date:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return new Date(e)}),Locale:function(e){return e.replace("_","-")},Model:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.prototype instanceof n.BaseCollection?function(t,i){var r=e.prototype.model.prototype.idAttribute,n=o.CollectionPool.getCollection(e).get(t[r],!0);return n.set(n.parse(t,i),i),n}:e.prototype instanceof r.BaseModel?function(i,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return t&&n&&(i.parent=n),new e(i,{parse:!0})}:void 0},Collection:function(e){return function(t,i){return new e(t,i)}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Config={apiVersion:"2017-09-13",baseUrl:"https://xola.com/api",apiKey:"595e291aa48cf267048b4568"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DemographicCollection=void 0;var r=i(1),n=i(12);t.DemographicCollection=r.BaseCollection.extend({model:n.Demographic},{POOL_ID:"Demographics"})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExperienceCollection=void 0;var r=i(1),n=i(24),o=i(14);t.ExperienceCollection=r.BaseCollection.extend({model:o.Experience,initialize:function(){var e=this;r.BaseCollection.prototype.initialize.apply(this,arguments),this.availability=new n.AvailabilityCollection(null,{experiences:this}),this.listenTo(this,"update",function(){e.availability.filters.experience=e.pluck("id").join(",")})},getAvailability:function(){return this.availability}},{POOL_ID:"Experiences"})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Account={currentUser:null}},function(e,i){e.exports=t},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={};t.CollectionPool={getCollection:function(e){if(!e.hasOwnProperty("POOL_ID"))throw new Error(e+" is not a valid Collection");return r.hasOwnProperty(e.POOL_ID)||(r[e.POOL_ID]=new e),r[e.POOL_ID]}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OrderDemographicCollection=void 0;var r=i(1),n=i(16);t.OrderDemographicCollection=r.BaseCollection.extend({model:n.OrderDemographic},{POOL_ID:"OrderDemographics"})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OrderCollection=void 0;var r=i(1),n=i(15);t.OrderCollection=r.BaseCollection.extend({model:n.Order},{POOL_ID:"Orders"})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Demographic=void 0;var r=i(0),n=i(2),o=function(e){return e&&e.__esModule?e:{default:e}}(n);t.Demographic=r.BaseModel.extend({urlRoot:"/demographics",demographicsMap:{children:["child","children","junior"],adult:["adults","adult","guest","guests"],senior:["senior","seniors"],veteran:["military","veteran","veterans","soldier","soldiers"]},getLabel:function(){return this.get("label")},guessDemographicIcon:function(e){return e=e||this.get("label"),e=e&&e.toLowerCase(),o.default.findKey(this.demographicsMap,function(t){return o.default.contains(t,e)})||"adult"}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Event=void 0;var r=i(0),n=i(3),o=i(6),l=i(11);t.Event=r.BaseModel.extend({urlRoot:"/events",isAllDay:function(){return"0000"===this.get("start").format("HHmm")}},{PARSERS:{start_date:n.ParseHelper.Date,experience:n.ParseHelper.Model(o.ExperienceCollection),orders:n.ParseHelper.Collection(l.OrderCollection)},OPEN_UNLIMITED:99999})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Experience=void 0;var r=i(0),n=i(19),o=i(5),l=i(26),s=i(3);t.Experience=r.BaseModel.extend({urlRoot:"/experiences",initialize:function(){r.BaseModel.prototype.initialize.apply(this,arguments),this.availability=new n.Availability(null,{parent:this}),this.fees=new l.FeeCollection(null,{parent:this}),this.has("seller")&&(this.fees.filters.seller=this.get("seller").id)},getAvailability:function(){return this.availability},getFees:function(){return this.fees}},{PARSERS:{demographics:s.ParseHelper.Collection(o.DemographicCollection)}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Order=void 0;var r=i(1),n=i(0),o=i(20),l=i(3),s=i(10),a=i(17);t.Order=n.BaseModel.extend({urlRoot:"/orders",calculateAmount:function(){var e=this.get("experience").get("price"),t=(this.get("experience").get("currency"),0),i=0;this.get("demographics").each(function(r){var n=r.get("quantity"),o=r.calculatePrice(e),l=o*n;i+=n,t+=l}),this.get("experience").get("priceType")===o.Fee.SCOPE_OUTING&&(t=e);var l=t,s=0,a=new r.BaseCollection;this.get("experience").getFees().each(function(e){var r=0;switch(e.get("scope")){case o.Fee.SCOPE_PERSON:r=e.get("amount")*i;break;case o.Fee.SCOPE_OUTING:switch(e.get("amountType")){case o.Fee.AMOUNT_TYPE_ABSOLUTE:r=e.get("amount");break;case o.Fee.AMOUNT_TYPE_PERCENT:r=t*e.get("amount")/100}}a.add(new n.BaseModel({type:"fee",amount:r,caption:e.get("name"),code:e.id,meta:{fee:e}})),s+=r}),l+=s,this.set("adjustments",a),this.set("quantity",i),this.set("amount",l)},checkIn:function(e){var t=new n.BaseModel({updates:{guestStatus:"arrived"}},{parent:this});t.urlRoot="/modify",t.save(null,e)},toJSON:function(){var e=n.BaseModel.prototype.toJSON.apply(this,arguments);return this.get("demographics")&&(e.demographics=this.get("demographics").toJSON()),this.get("seller")&&(e.seller={id:this.get("seller").id}),this.get("experience")&&(e.experience={id:this.get("experience").id}),this.get("payment")&&(e.payment=this.get("payment").toJSON()),e},getMaxQuantity:function(){var e=this.get("experience").get("group");if(e){var t=e.outingMax||Event.OPEN_UNLIMITED;if(this.availability&&this.availability.isAvailable()){var i=this.availability.getTotalOpenCount();if(i<t&&(t=i),this.availability.hasTimeSlots()&&this.has("arrivalTime")){var r=this.availability.get("slots").find({time:this.get("arrivalTime").toString()});r&&r.get("count")!=Event.OPEN_UNLIMITED&&(t=r.get("count"))}}return t}}},{PARSERS:{demographics:l.ParseHelper.Collection(s.OrderDemographicCollection),payment:l.ParseHelper.Model(a.Payment)}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OrderDemographic=void 0;var r=i(0),n=i(3),o=i(5);t.OrderDemographic=r.BaseModel.extend({urlRoot:null,initialize:function(e){r.BaseModel.prototype.initialize.apply(this,arguments),this.set({id:e.demographic.id,label:e.demographic.getLabel()})},getQuantity:function(){return this.get("quantity")},setQuantity:function(e){return this.set("quantity",e)},calculatePrice:function(e){var t=this.get("demographic");if(!t.has("discount"))return e;switch(t.get("discount").amountType){case"absolute":return e-t.get("discount").amount;default:return e}}},{PARSERS:{demographic:n.ParseHelper.Model(o.DemographicCollection)}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Payment=void 0;var r=i(2),n=function(e){return e&&e.__esModule?e:{default:e}}(r),o=i(29),l=i(0),s=i(3),a={METHOD_CREDIT_CARD:"cc"};t.Payment=l.BaseModel.extend({toJSON:function(){var e=l.BaseModel.prototype.toJSON.apply(this,arguments);switch(this.get("method")){case a.METHOD_CREDIT_CARD:e.card=this.get("card").toJSON()}return e}},n.default.extend({PARSERS:{card:s.ParseHelper.Model(o.Card)}},a))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.User=void 0;var r=i(2),n=function(e){return e&&e.__esModule?e:{default:e}}(r),o=i(0),l=i(3),s=i(32),a=i(25),u={ROLE_SELLER:"ROLE_SELLER",ROLE_SUPER_ADMIN:"ROLE_SUPER_ADMIN",ROLE_ADMIN:"ROLE_ADMIN",ROLE_RESERVATION:"ROLE_RESERVATION",ROLE_RESERVATION_LITE:"ROLE_RESERVATION_LITE",ROLE_GUIDE_MANAGER:"ROLE_GUIDE_MANAGER"};t.User=o.BaseModel.extend({urlRoot:"/users",initialize:function(){o.BaseModel.prototype.initialize.apply(this,arguments),this.delegators=new a.DelegatorCollection},hasRole:function(e){return n.default.contains(this.get("roles"),e)},isSeller:function(){return this.hasRole(u.ROLE_SELLER)},isAdmin:function(){return this.hasRole(u.ROLE_ADMIN)||this.hasRole(u.ROLE_SUPER_ADMIN)},isReservationist:function(){return this.hasRole(u.ROLE_RESERVATION)||this.hasRole(u.ROLE_RESERVATION_LITE)},isGuideManager:function(){return this.hasRole(u.ROLE_GUIDE_MANAGER)},getDelegators:function(){return this.delegators}},n.default.extend({PARSERS:{locale:l.ParseHelper.Locale,meta:l.ParseHelper.Model(s.Meta)}},u))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Availability=void 0;var r=i(0);t.Availability=r.BaseModel.extend({urlRoot:"/availability",initialize:function(){r.BaseModel.prototype.initialize.apply(this,arguments)},parse:function(e,t){return t.parent=e._experience,delete e._experience,r.BaseModel.prototype.parse.call(this,e,t)},getSlotsByDate:function(e){return this.get(e)},getSlotsByDateTime:function(e,t){return this.getSlotsByDate(e)[t]},isAvailable:function(){return!this.isBlackedOut()&&this.getTotalOpenCount()>0},isBlackedOut:function(){var e=!1;if(this.hasTimeSlots()){var t=this.get("slots");if(1===t.length){var i=t.at(0);0===i.get("count")&&0===i.get("time")&&(e=!0)}}return e},hasTimeSlots:function(){if(this.has("slots")&&this.get("slots").size()){var e=this.get("slots");return!(1===e.size()&&0===e.at(0).get("time"))}return!1},getTotalOpenCount:function(){var e=0;return this.get("slots").each(function(t){e+=t.get("count")}),e}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Fee=void 0;var r=i(0);t.Fee=r.BaseModel.extend({urlRoot:"/fees"},{AMOUNT_TYPE_PERCENT:"percent",AMOUNT_TYPE_ABSOLUTE:"absolute",SCOPE_PERSON:"person",SCOPE_OUTING:"outing"})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventCollection=void 0;var r=i(1),n=i(13);t.EventCollection=r.BaseCollection.extend({model:n.Event},{POOL_ID:"Events"})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserCollection=void 0;var r=i(1),n=i(18);t.UserCollection=r.BaseCollection.extend({model:n.User},{POOL_ID:"Users"})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Seller=void 0;var r=i(0),n=i(6),o=i(27);t.Seller=r.BaseModel.extend({urlRoot:"/sellers",initialize:function(){this.experiences=new n.ExperienceCollection,this.experiences.filters.seller=this.id,this.guides=new o.GuideCollection(null,{parent:this}),this.guides.filters.seller=this.id},getExperiences:function(){return this.experiences},getGuides:function(){return this.guides}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AvailabilityCollection=void 0;var r=i(2),n=function(e){return e&&e.__esModule?e:{default:e}}(r),o=i(1),l=i(19);t.AvailabilityCollection=o.BaseCollection.extend({model:l.Availability,initialize:function(e,t){var i=this;o.BaseCollection.prototype.initialize.apply(this,arguments),this.experiences=t.experiences,this.listenTo(this,"update",function(){i.each(function(e){e.parent.getAvailability().set(e.attributes)})})},parse:function(e){var t=this,i=[];return n.default.each(e,function(e,r,n){e._experience=t.experiences.get(r),i.push(e)}),i}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DelegatorCollection=void 0;var r=i(1),n=i(30);t.DelegatorCollection=r.BaseCollection.extend({model:n.Delegator})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FeeCollection=void 0;var r=i(1),n=i(20);t.FeeCollection=r.BaseCollection.extend({model:n.Fee},{POOL_ID:"Fees"})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GuideCollection=void 0;var r=i(1),n=i(31);t.GuideCollection=r.BaseCollection.extend({model:n.Guide,findByUser:function(e){return this.find(function(t){return t.get("user").id==e.id})}},{POOL_ID:"Guides"})},function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var n,o=i(2),l=r(o),s=i(8),a=r(s),u=i(4),c=i(0),d=i(1),p=i(12),f=i(14),h=i(13),g=i(15),v=i(16),y=i(17),O=i(23),_=i(18),E=i(5),m=i(6),M=i(21),b=i(11),C=i(10),P=i(22),R=i(9),x=i(7),A={BaseModel:c.BaseModel,BaseCollection:d.BaseCollection,Model:{Demographic:p.Demographic,Experience:f.Experience,Event:h.Event,Order:g.Order,OrderDemographic:v.OrderDemographic,Payment:y.Payment,Seller:O.Seller,User:_.User},Collection:{Demographics:E.DemographicCollection,Experiences:m.ExperienceCollection,Events:M.EventCollection,Orders:b.OrderCollection,OrderDemographics:C.OrderDemographicCollection,Users:P.UserCollection},Service:{Account:x.Account},CollectionPool:R.CollectionPool,Config:u.Config,setUser:function(e){x.Account.currentUser=e},getUser:function(){return x.Account.currentUser},login:function(e,t,i){var r=this;i=i||{};var n=i.beforeSend,o=i.success;return i.beforeSend=function(i,o){if(o.crossDomain=!0,i.setRequestHeader("Authorization","Basic "+btoa(e+":"+t)),n)return n.call(r,i,o)},i.success=function(e,t,i){o&&o.call(r,e,t,i),r.trigger("user.login",e)},x.Account.currentUser=new _.User({id:"me"}),x.Account.currentUser.fetch(i),x.Account.currentUser},logout:function(){x.Account.currentUser=null,this.trigger("user.logout")}};n||(l.default.extend(A,a.default.Events),n=!0),e.exports=A},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Card=void 0;var r=i(0),n=i(33),o=function(e){return e&&e.__esModule?e:{default:e}}(n);t.Card=r.BaseModel.extend({defaults:function(){return{number:"",cvv:"",expiryMonth:"",expiryYear:"",billingState:"",billingPostcode:"",billingName:"",billingCity:"",billingAddress:""}},validation:function(){return{billingName:{required:!0},number:{required:!0,creditCard:!0},cvv:{required:!(this.has("swipe")&&this.get("swipe")),cvv:!0,pattern:"number",length:"American Express"===this.cardType()?4:3},expiryMonth:{required:!0,pattern:"number"},expiryYear:{required:!0,pattern:"number"},billingPostcode:{required:!0}}},cardType:function(){var e=this.get("number"),t={};if(t[51]="Mastercard",t[52]="Mastercard",t[53]="Mastercard",t[54]="Mastercard",t[55]="Mastercard",t[34]="American Express",t[37]="American Express",t[4]="VISA",t[6]="Discover Card",t[35]="JCB",t[30]="Diners Club",t[36]="Diners Club",t[38]="Diners Club",e){e=o.default.trim(e.toString());for(var i in t)if(0===e.indexOf(i))return t[i]}return null}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Delegator=void 0;var r=i(0),n=i(4);t.Delegator=r.BaseModel.extend({urlRoot:"/delegators",getPictureUrl:function(e){return e=e||"small",n.Config.baseUrl+this.url("/users")+"/picture?size="+e}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Guide=void 0;var r=i(0);t.Guide=r.BaseModel.extend({urlRoot:"/guides"})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Meta=void 0;var r=i(0);t.Meta=r.BaseModel.extend({urlRoot:"/meta"})},function(e,t){e.exports=i}])});