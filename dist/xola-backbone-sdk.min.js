!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("underscore"),require("backbone")):"function"==typeof define&&define.amd?define(["underscore","backbone"],t):"object"==typeof exports?exports.XolaBackboneSDK=t(require("underscore"),require("backbone")):e.XolaBackboneSDK=t(e._,e.Backbone)}(this,function(e,t){return function(e){function t(n){if(i[n])return i[n].exports;var o=i[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var i={};return t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=28)}([function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.BaseModel=void 0;var o=i(2),r=n(o),l=i(6),s=n(l),a=i(3),u=i(5);t.BaseModel=s.default.Model.extend({parent:null,parentUrlRoot:null,filters:null,initialize:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r.default.defaults(t,{parent:null}),this.parent=t.parent,this.filters={}},url:function(e){var t,i=this.parent?this.parent.url(this.parentUrlRoot):"";if(e)if(this.isNew())t=e;else{var n=this.get(this.idAttribute);t=e.replace(/[^\/]$/,"$&/")+encodeURIComponent(n)}else t=s.default.Model.prototype.url.apply(this);return i+t},sync:function(e,t,i){var n=this,o=i.beforeSend;return i.beforeSend=function(e,t){if(t.url=a.Config.baseUrl+t.url,t.crossDomain=!0,u.Account.currentUser&&u.Account.currentUser.has("apiKey")&&e.setRequestHeader("X-API-KEY",u.Account.currentUser.get("apiKey")),e.setRequestHeader("X-API-VERSION",a.Config.apiVersion),o)return o.call(n,e,t)},s.default.Model.prototype.sync.call(this,e,t,i)},fetch:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r.default.defaults(e,{data:{}}),r.default.extend(e.data,this.filters),s.default.Model.prototype.fetch.apply(this,[e])},parse:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e?(r.default.each(e,function(n,o){var r=n;t.constructor.PARSERS&&t.constructor.PARSERS[o]&&(r=t.constructor.PARSERS[o](n,i,t),r instanceof s.default.Model&&t.has(o)&&t.get(o).id==r.id&&(t.get(o).set(r.attributes),r=t.get(o)),r instanceof s.default.Collection&&t.has(o)&&(t.get(o).set(r.models),r=t.get(o))),e[o]=r}),e):e}})},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.BaseCollection=void 0;var o=i(2),r=n(o),l=i(6),s=n(l),a=i(0),u=i(3),c=i(5);t.BaseCollection=s.default.Collection.extend({model:a.BaseModel,parent:null,filters:null,paging:{next:null},initialize:function(){var e=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});r.default.defaults(e,{parent:null}),this.parent=e.parent,this.filters={}},url:function(){return(this.parent?this.parent.url():"")+(this.urlRoot?this.urlRoot:this.model.prototype.urlRoot)},parse:function(e){return e.hasOwnProperty("paging")&&e.hasOwnProperty("data")?(this.paging.next=e.paging.next,e.data):e},sync:function(e,t,i){var n=this,o=i.beforeSend;return i.beforeSend=function(e,t){if(t.url=u.Config.baseUrl+t.url,t.crossDomain=!0,c.Account.currentUser&&c.Account.currentUser.has("apiKey")&&e.setRequestHeader("X-API-KEY",c.Account.currentUser.get("apiKey")),e.setRequestHeader("X-API-VERSION",u.Config.apiVersion),o)return o.call(n,e,t)},s.default.Collection.prototype.sync.call(this,e,t,i)},get:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=s.default.Collection.prototype.get.call(this,e);if(!i&&t){var n={};n[this.model.prototype.idAttribute]=e,i=new this.model(n),this.add(i)}return i},fetch:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r.default.defaults(e,{data:{}}),r.default.extend(e.data,this.filters),s.default.Collection.prototype.fetch.apply(this,[e])}},{buildModelPropertyComparator:function(e){return function(t){return t.get(e)}}})},function(t,i){t.exports=e},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Config={apiVersion:"2017-09-13",baseUrl:"https://xola.com/api"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExperienceCollection=void 0;var n=i(1),o=i(24),r=i(12);t.ExperienceCollection=n.BaseCollection.extend({model:r.Experience,initialize:function(){var e=this;n.BaseCollection.prototype.initialize.apply(this,arguments),this.availability=new o.AvailabilityCollection(null,{experiences:this}),this.listenTo(this,"update",function(){e.availability.filters.experience=e.pluck("id").join(",")})},getAvailability:function(){return this.availability}},{POOL_ID:"Experiences"})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Account={currentUser:null}},function(e,i){e.exports=t},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParseHelper=void 0;var n=i(0),o=i(1),r=i(8);t.ParseHelper={Date:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return new Date(e)}),Locale:function(e){return e.replace("_","-")},Model:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.prototype instanceof o.BaseCollection?function(t,i){var n=e.prototype.model.prototype.idAttribute,o=r.CollectionPool.getCollection(e).get(t[n],!0);return o.set(o.parse(t,i),i),o}:e.prototype instanceof n.BaseModel?function(i,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return t&&o&&(i.parent=o),new e(i,{parse:!0})}:void 0},Collection:function(e){return function(t,i){return new e(t,i)}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={};t.CollectionPool={getCollection:function(e){if(!e.hasOwnProperty("POOL_ID"))throw new Error(e+" is not a valid Collection");return n.hasOwnProperty(e.POOL_ID)||(n[e.POOL_ID]=new e),n[e.POOL_ID]}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DemographicCollection=void 0;var n=i(1),o=i(10);t.DemographicCollection=n.BaseCollection.extend({model:o.Demographic},{POOL_ID:"Demographics"})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Demographic=void 0;var n=i(0);t.Demographic=n.BaseModel.extend({urlRoot:"/demographics",getLabel:function(){return this.get("label")}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Event=void 0;var n=i(0),o=i(7),r=i(4);t.Event=n.BaseModel.extend({urlRoot:"/events",isAllDay:function(){return"0000"===this.get("start").format("HHmm")}},{PARSERS:{start_date:o.ParseHelper.Date,experience:o.ParseHelper.Model(r.ExperienceCollection)}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Experience=void 0;var n=i(0),o=i(16),r=i(9),l=i(26),s=i(7);t.Experience=n.BaseModel.extend({urlRoot:"/experiences",initialize:function(){n.BaseModel.prototype.initialize.apply(this,arguments),this.availability=new o.Availability(null,{parent:this}),this.fees=new l.FeeCollection(null,{parent:this}),this.has("seller")&&(this.fees.filters.seller=this.get("seller").id)},getAvailability:function(){return this.availability},getFees:function(){return this.fees}},{PARSERS:{demographics:s.ParseHelper.Collection(r.DemographicCollection)}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Order=void 0;var n=i(1),o=i(0),r=i(17);t.Order=o.BaseModel.extend({urlRoot:"/orders",calculateAmount:function(){var e=this,t=this.get("experience").get("price"),i=(this.get("experience").get("currency"),t),l=0;this.get("demographics").each(function(e){var n=e.get("quantity"),o=e.calculatePrice(t),r=o*n;l+=n,i+=r});var s=i,a=0,u=new n.BaseCollection;this.get("experience").getFees().each(function(t){var n=0;switch(t.get("scope")){case r.Fee.SCOPE_PERSON:n=t.get("amount")*l;break;case r.Fee.SCOPE_OUTING:switch(t.get("amountType")){case r.Fee.AMOUNT_TYPE_ABSOLUTE:n=e.get("amount");break;case r.Fee.AMOUNT_TYPE_PERCENT:n=i*t.get("amount")/100}}u.add(new o.BaseModel({type:"fee",amount:n,caption:"Fee",code:t.id,meta:{fee:t}})),a+=n}),s+=a,this.set("adjustments",u),this.set("quantity",l),this.set("amount",s)},checkIn:function(e){var t=new o.BaseModel({updates:{guestStatus:"arrived"}},{parent:this});t.urlRoot="/modify",t.save(null,e)},toJSON:function(){var e=o.BaseModel.prototype.toJSON.apply(this,arguments);return this.get("demographics")&&(e.demographics=this.get("demographics").toJSON()),this.get("seller")&&(e.seller={id:this.get("seller").id}),this.get("experience")&&(e.experience={id:this.get("experience").id}),this.get("payment")&&(e.payment=this.get("payment").toJSON()),e}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OrderDemographic=void 0;var n=i(0);t.OrderDemographic=n.BaseModel.extend({urlRoot:null,initialize:function(e){n.BaseModel.prototype.initialize.apply(this,arguments),this.set({id:e.demographic.id,label:e.demographic.getLabel()})},getQuantity:function(){return this.get("quantity")},setQuantity:function(e){return this.set("quantity",e)},calculatePrice:function(e){var t=this.get("demographic");if(!t.has("discount"))return e;switch(t.get("discount").amountType){case"absolute":return e-t.get("discount").amount;default:return e}}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.User=void 0;var n=i(2),o=function(e){return e&&e.__esModule?e:{default:e}}(n),r=i(0),l=i(7),s=i(31),a=i(25),u={ROLE_SELLER:"ROLE_SELLER",ROLE_SUPER_ADMIN:"ROLE_SUPER_ADMIN",ROLE_ADMIN:"ROLE_ADMIN",ROLE_RESERVATION:"ROLE_RESERVATION",ROLE_RESERVATION_LITE:"ROLE_RESERVATION_LITE",ROLE_GUIDE_MANAGER:"ROLE_GUIDE_MANAGER"};t.User=r.BaseModel.extend({urlRoot:"/users",initialize:function(){r.BaseModel.prototype.initialize.apply(this,arguments),this.delegators=new a.DelegatorCollection(null,{parent:this})},hasRole:function(e){return o.default.contains(this.get("roles"),e)},isSeller:function(){return this.hasRole(u.ROLE_SELLER)},isAdmin:function(){return this.hasRole(u.ROLE_ADMIN)||this.hasRole(u.ROLE_SUPER_ADMIN)},isReservationist:function(){return this.hasRole(u.ROLE_RESERVATION)||this.hasRole(u.ROLE_RESERVATION_LITE)},isGuideManager:function(){return this.hasRole(u.ROLE_GUIDE_MANAGER)},getDelegators:function(){return this.delegators}},o.default.extend({PARSERS:{locale:l.ParseHelper.Locale,meta:l.ParseHelper.Model(s.Meta)}},u))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Availability=void 0;var n=i(0);t.Availability=n.BaseModel.extend({urlRoot:"/availability",initialize:function(){n.BaseModel.prototype.initialize.apply(this,arguments)},parse:function(e,t){return t.parent=e._experience,delete e._experience,n.BaseModel.prototype.parse.call(this,e,t)},getSlotsByDate:function(e){return this.get(e)},getSlotsByDateTime:function(e,t){return this.getSlotsByDate(e)[t]}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Fee=void 0;var n=i(0);t.Fee=n.BaseModel.extend({urlRoot:"/fees"},{AMOUNT_TYPE_PERCENT:"percent",AMOUNT_TYPE_ABSOLUTE:"absolute",SCOPE_PERSON:"person",SCOPE_OUTING:"outing"})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventCollection=void 0;var n=i(1),o=i(11);t.EventCollection=n.BaseCollection.extend({model:o.Event},{POOL_ID:"Events"})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OrderDemographicCollection=void 0;var n=i(1),o=i(14);t.OrderDemographicCollection=n.BaseCollection.extend({model:o.OrderDemographic},{POOL_ID:"OrderDemographics"})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OrderCollection=void 0;var n=i(1),o=i(13);t.OrderCollection=n.BaseCollection.extend({model:o.Order},{POOL_ID:"Orders"})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserCollection=void 0;var n=i(1),o=i(15);t.UserCollection=n.BaseCollection.extend({model:function(){o.User}},{POOL_ID:"Users"})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Payment=void 0;var n=i(2),o=function(e){return e&&e.__esModule?e:{default:e}}(n),r=i(0),l={METHOD_CREDIT_CARD:"cc"};t.Payment=r.BaseModel.extend({toJSON:function(){var e=r.BaseModel.prototype.toJSON.apply(this,arguments);switch(this.get("method")){case l.METHOD_CREDIT_CARD:e.card=this.get("card").toJSON()}return e}},o.default.extend({PARSERS:{}},l))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Seller=void 0;var n=i(0),o=i(4),r=i(27);t.Seller=n.BaseModel.extend({urlRoot:"/sellers",initialize:function(){this.experiences=new o.ExperienceCollection,this.experiences.filters.seller=this.id,this.guides=new r.GuideCollection,this.guides.filters.seller=this.id},getExperiences:function(){return this.experiences},getGuides:function(){return this.guides}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AvailabilityCollection=void 0;var n=i(2),o=function(e){return e&&e.__esModule?e:{default:e}}(n),r=i(1),l=i(16);t.AvailabilityCollection=r.BaseCollection.extend({model:l.Availability,initialize:function(e,t){var i=this;r.BaseCollection.prototype.initialize.apply(this,arguments),this.experiences=t.experiences,this.listenTo(this,"update",function(){i.each(function(e){e.parent.getAvailability().set(e.attributes)})})},parse:function(e){var t=this,i=[];return o.default.each(e,function(e,n,o){e._experience=t.experiences.get(n),i.push(e)}),i}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DelegatorCollection=void 0;var n=i(1),o=i(29);t.DelegatorCollection=n.BaseCollection.extend({model:o.Delegator,parse:function(e){return e.hasOwnProperty("sellers")?e.sellers:e}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FeeCollection=void 0;var n=i(1),o=i(17);t.FeeCollection=n.BaseCollection.extend({model:o.Fee},{POOL_ID:"Fees"})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GuideCollection=void 0;var n=i(1),o=i(30);t.GuideCollection=n.BaseCollection.extend({model:o.Guide,findByUser:function(e){this.find(function(t){return t.get("user").id==e.id})}},{POOL_ID:"Guides"})},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var o,r=i(2),l=n(r),s=i(6),a=n(s),u=i(3),c=i(0),d=i(1),p=i(10),f=i(12),h=i(11),v=i(13),g=i(14),_=i(22),O=i(23),y=i(15),E=i(9),R=i(4),M=i(18),P=i(20),b=i(19),m=i(21),C=i(8),x=i(5),A={BaseModel:c.BaseModel,BaseCollection:d.BaseCollection,Model:{Demographic:p.Demographic,Experience:f.Experience,Event:h.Event,Order:v.Order,OrderDemographic:g.OrderDemographic,Payment:_.Payment,Seller:O.Seller,User:y.User},Collection:{Demographics:E.DemographicCollection,Experiences:R.ExperienceCollection,Events:M.EventCollection,Orders:P.OrderCollection,OrderDemographics:b.OrderDemographicCollection,Users:m.UserCollection},Service:{Account:x.Account},CollectionPool:C.CollectionPool,Config:u.Config,setUser:function(e){x.Account.currentUser=e},getUser:function(){return x.Account.currentUser},login:function(e,t,i){var n=this;i=i||{};var o=i.beforeSend,r=i.success;return i.beforeSend=function(i,r){if(r.crossDomain=!0,i.setRequestHeader("Authorization","Basic "+btoa(e+":"+t)),o)return o.call(n,i,r)},i.success=function(e,t,i){r&&r.call(n,e,t,i),n.trigger("user.login",e)},x.Account.currentUser=new y.User({id:"me"}),x.Account.currentUser.fetch(i),x.Account.currentUser},logout:function(){x.Account.currentUser=null,this.trigger("user.logout")}};o||(l.default.extend(A,a.default.Events),o=!0),e.exports=A},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Delegator=void 0;var n=i(0),o=i(3);t.Delegator=n.BaseModel.extend({urlRoot:"/delegators",getPictureUrl:function(e){return e=e||"small",o.Config.baseUrl+this.url("/users")+"/picture?size="+e}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Guide=void 0;var n=i(0);t.Guide=n.BaseModel.extend({urlRoot:"/guides"})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Meta=void 0;var n=i(0);t.Meta=n.BaseModel.extend({urlRoot:"/meta"})}])});